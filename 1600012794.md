# 计算机系统导论作业

**姓名：**`王希豪`

**学号：**`1600012794`

**讨论班班号：**`21`

**教师：**`曹东刚`

**助教：**`金典`

## 第一次作业

**提交时间：**`2017-9-18`

### 2.61

**解：**

```c
A. !~x
```

```c
B. !x
```

```c
C. !~(~0xff|x)
   //如果假设int为32位的话，也可以写成!~(0xffffff00|x)
```


```c
D. !(~(INT_MAX>>7)&x) 或者 !(-1<<((sizeof(int)-1)<<3)&x)
   //如果假设int为32位的话，也可以写成!(0xff000000&x)
```


**说明：**


根据优先级表，`!`运算符和`~`运算符属于同个优先级，但是要从右往左依次计算，所以A题的表达式计算时，将首先进行`~`运算再进行`!`运算。如果x所有位都是1，那么`~`运算之后所有位都是0，再通过`!`运算可得到1，否则将得到0。

C题和D题使用`~0xff`和`~(INT_MAX>>7)`是考虑到不同机器上int类型的大小可能会不同。用`~(INT_MAX>>7)`来获得二进制首8位为1、其他位为0的int类型数而不用`-1u>>8`是考虑到不同机器的右移运算可能是逻辑右移也可能是算数右移（虽然大多数机器中的c语言都默认无符号整型的右移运算是逻辑右移）。




### 2.62

**解：**

```c
int int_shifts_are_arithmetic() {
    return !~(-1 >> 1);
}
```

**说明：**

int类型的数，当其值为-1时，其二进制表示所有位都是1，对其进行右移1位操作，如果计算机使用算数右移，那么得到的数依旧是-1（即二进制表示下所有位都是1），如果计算机使用逻辑右移，那么得到的数会是`INT_MAX`（即二进制表示下，首位为0，其他位为1），所以只要判断-1右移一位后是否还是-1就可以判断计算机使用的是算数右移还是逻辑右移

### 2.65

**解：**

```c
int odd_ones(unsigned x) {
    x = x >> 1 ^ x;
    x = x >> 2 ^ x;
    x = x >> 4 ^ x;
    x = x >> 8 ^ x;
    x = x >> 16 ^ x;
    return x & 1;
}
```

**说明：**

本题是求一个数二进制表示中1的个数是否为奇数，根据异或的原理，奇数个1异或的结果为1，偶数个1异或的结果为0，所以，只要将x的所有位异或起来就可以得到答案。

首先，将x和其右移一位后的结果异或得到x'，则x'的第i位相当于x的第i位和第i+1位的异或结果。

同理，将x'和其右移二位后的结果异或得到x''，则x''的第i位相当于x的第i、i+1、i+2、i+3位的异或结果。

依次计算后，最后得到的数的第0位（最低位）就是x所有二进制位的异或结果，通过`&1`运算将这一位提取出来就是所求的答案。
